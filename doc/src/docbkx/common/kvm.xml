<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="kvm">
    <?dbhtml stop-chunking?>
    <title>KVM</title>
<para>KVM is configured as the default hypervisor for Compute. To enable KVM explicitly, add the
        following configuration options
        <filename>/etc/nova/nova.conf</filename>:<programlisting>connection_type=libvirt
libvirt_type=kvm</programlisting>
        The KVM hypervisor supports the following virtual machine image formats:<itemizedlist>
            <listitem>
                <para>Raw</para>
            </listitem>
            <listitem>
                <para>QEMU Copy-on-write (qcow2)</para>
            </listitem>
            <listitem>
                <para>VMWare virtual machine disk format (vmdk)</para>
            </listitem>
        </itemizedlist></para>
    <para>The rest of this section describes how to enable KVM on your system. You may also wish to
        consult distribution-specific documentation:<itemizedlist>
            <listitem>
                <para><link
                        xlink:href="http://fedoraproject.org/wiki/Getting_started_with_virtualization"
                        >Fedora: Getting started with virtualization</link> from the Fedora project
                    wiki.</para>
            </listitem>
            <listitem>
                <para><link xlink:href="https://help.ubuntu.com/community/KVM/Installation">Ubuntu:
                        KVM/Installation</link> from the Community Ubuntu documentation.</para>
            </listitem>
            <listitem>
                <para><link
                        xlink:href="http://static.debian-handbook.info/browse/stable/sect.virtualization.html#idp11279352"
                        >Debian: Virtualization with KVM</link> from the Debian handbook.</para>
            </listitem>
            <listitem>
                <para><link
                        xlink:href="http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Virtualization_Host_Configuration_and_Guest_Installation_Guide/sect-Virtualization_Host_Configuration_and_Guest_Installation_Guide-Host_Installation-Installing_KVM_packages_on_an_existing_Red_Hat_Enterprise_Linux_system.html"
                        >RHEL: Installing virtualization packages on an existing Red Hat Enterprise
                        Linux system</link> from the Red Hat Enterprise Linux Virtualizaiton Host
                    Configuration and Guest Installation Guide.</para>
            </listitem>
            <listitem>
                <para><link
                        xlink:href="http://doc.opensuse.org/documentation/html/openSUSE/opensuse-kvm/cha.kvm.requires.html#sec.kvm.requires.install"
                        >openSUSE: Installing KVM</link> from the openSUSE Virtualization with KVM
                    manual.</para>
            </listitem>
            <listitem>
                <para><link
                        xlink:href="http://doc.opensuse.org/products/draft/SLES/SLES-kvm_sd_draft/cha.kvm.requires.html#sec.kvm.requires.install"
                        >SLES: Installing KVM</link> from the SUSE Linux Enterprise
                    ServerVirtualization with KVM manual.</para>
            </listitem>
        </itemizedlist></para>
    <section xml:id="checking-kvm">
        <title>Checking for hardware virtualization support</title>
        <para>The processors of your compute host need to support virtualization technology (VT) to
            use KVM. </para>
        <para>If you are running on Ubuntu, use the <command>kvm-ok</command> command to check if
            your processor has VT support, it is enabled in the BIOS, and KVM is installed properly,
            as root:<screen><prompt>#</prompt> <userinput>kvm-ok</userinput></screen></para>
        <para>If KVM is enabled, the output should look something
            like:<screen><computeroutput>INFO: /dev/kvm exists
KVM acceleration can be used</computeroutput></screen></para>
        <para>If KVM is not enabled, the output should look something
            like:<screen><computeroutput>INFO: Your CPU does not support KVM extensions
KVM acceleration can NOT be used</computeroutput></screen></para>
        <para>In the case that KVM acceleration is not supported, Compute should be configured to
            use a different hypervisor, such as <link linkend="qemu">QEMU</link> or <link
                linkend="introduction-to-xen">Xen</link>.</para>
        <para>On distributions that don't have <command>kvm-ok</command>, you can check if your
            processor has VT support by looking at the processor flags in the
                <filename>/proc/cpuinfo</filename> file. For Intel processors, look for the
                <literal>vmx</literal> flag, and for AMD processors, look for the
                <literal>svm</literal> flag. A simple way to check is to run the following command
            and see if there is any
            output:<screen><prompt>$</prompt> <userinput>egrep '(vmx|svm)' --color=always /proc/cpuinfo</userinput></screen></para>
        <para>Some systems require that you enable VT support in the system BIOS. If you believe
            your processor supports hardware acceleration but the above command produced no output,
            you may need to reboot your machine, enter the system BIOS, and enable the VT
            option.</para>
    </section>

    <section xml:id="enabling-kvm">
        <title>Enabling KVM</title>
        <para>KVM requires the <literal>kvm </literal>and either <literal>kvm-intel</literal> or
                <literal>kvm-amd</literal> modules to be loaded. This may have been configured
            automatically on your distribution when KVM is installed. </para>
        <para>You can check that they have been loaded using <command>lsmod</command>, as follows,
            with expected output for Intel-based
            processors:<screen><prompt>$</prompt> <userinput>lsmod | grep kvm</userinput>
<computeroutput>kvm_intel             137721  9
kvm                   415459  1 kvm_intel</computeroutput></screen>The
            following sections describe how to load the kernel modules for Intel-based and AMD-based
            processors if they were not loaded automatically by your distribution's KVM installation
            process.</para>

        <section xml:id="kvm-intel">
            <title>Intel-based processors</title>
        <para>If your compute host is Intel-based, run the following as root to load the kernel
                modules:<screen><prompt>#</prompt> modprobe kvm
<prompt>#</prompt> modprobe kvm-intel</screen>
                Add the following lines to <filename>/etc/modules</filename> so that these modules
                will load on reboot:<programlisting>kvm
kvm-intel</programlisting></para>
</section>
        <section xml:id="kvm-amd">
            <title>AMD-based processors</title>
            <para>If your compute host is AMD-based, run the following as root to load the kernel
                modules:<screen><prompt>#</prompt> modprobe kvm
<prompt>#</prompt> modprobe kvm-amd</screen>
                Add the following lines to <filename>/etc/modules</filename> so that these modules
                will load on reboot:<programlisting>kvm
kvm-amd</programlisting></para>
           </section>
    </section>
    <section xml:id="xml-troubleshooting">
        <title>Troubleshooting</title>
        <para>Trying to launch a new virtual machine instance fails with the
                <literal>ERROR</literal> state, and the following error appears in
                <filename>/var/log/nova/nova-compute.log</filename><screen><computeroutput>libvirtError: internal error no supported architecture for os type 'hvm'</computeroutput></screen>
            This is a symptom that the KVM kernel modules have not been loaded.</para>
    </section>
</section>
